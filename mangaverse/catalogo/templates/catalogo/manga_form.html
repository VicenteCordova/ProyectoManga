{% extends 'base.html' %}
{% block title %}{{ view.object|default:'Nuevo Manga' }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="h3 text-white mb-4">{{ view.object|default:'Nuevo Manga' }}</h1>

  <form method="post" enctype="multipart/form-data" class="card bg-dark border-secondary p-4">
    {% csrf_token %}
    
    <h4 class="text-primary mb-3">Información General</h4>
    {{ form.as_p }}

    <hr class="border-secondary my-4">

    <h4 class="text-info mb-3">Arcos / Sagas</h4>
    <p class="text-white-50 small">Define los arcos narrativos (Ej: "Saga de Introducción").</p>
    
    {{ arcs_formset.management_form }}
    <div class="table-responsive mb-4">
        <table class="table table-dark table-borderless align-middle">
            {{ arcs_formset.as_table }}
        </table>
    </div>

    {% if chapters_formset %}
        <hr class="border-secondary my-4">
        <h4 class="text-success mb-3">Capítulos</h4>
        <p class="text-white-50 small">Sube capítulos y asígnalos a un Arco si corresponde.</p>
        
        {{ chapters_formset.management_form }}
        <div class="accordion" id="chaptersAccordion">
            {% for form in chapters_formset %}
                <div class="accordion-item bg-dark border-secondary mb-2">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed bg-dark text-white shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                            Capítulo #{{ forloop.counter }}
                        </button>
                    </h2>
                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#chaptersAccordion">
                        <div class="accordion-body">
                            {{ form.as_p }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="mt-4 d-flex gap-2">
        <button class="btn btn-brand-neon px-5" type="submit">Guardar Todo</button>
        <a href="{% url 'catalogo:lista-mangas' %}" class="btn btn-outline-light">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}