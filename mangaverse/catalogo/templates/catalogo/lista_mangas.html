{% extends 'base.html' %}
{% load static %}

{% block title %}Catálogo | MangaVerse{% endblock %}

{% block content %}
<div class="container py-5">
  
  <div class="row align-items-end mb-5 border-bottom border-secondary border-opacity-25 pb-4">
    <div class="col-md-8">
      <h1 class="display-4 fw-bold text-white mb-0 text-uppercase ls-1" style="font-family: 'Rajdhani', sans-serif;">
        Explorar <span class="text-gradient-cyan">Mangas</span>
      </h1>
      <p class="text-secondary mt-2 mb-0">
        Descubre tu próxima obsesión entre nuestra colección de <span class="text-white fw-bold">{{ mangas.count }}</span> títulos.
      </p>
    </div>
    
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      {% if user.is_authenticated %}
        <a href="{% url 'catalogo:manga-create' %}" class="btn btn-brand-neon px-4 py-2 rounded-pill shadow-neon transition-transform hover-lift">
          <span class="fs-5 align-middle me-1">+</span> Nuevo Manga
        </a>
      {% endif %}
    </div>
  </div>

  {% if mangas %}
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
      {% for manga in mangas %}
        <div class="col">
          
          <div class="card mv-card h-100 border-0 overflow-hidden position-relative group-hover bg-dark">
            <a href="{% url 'catalogo:manga-detail' manga_slug=manga.slug %}" class="text-decoration-none d-block h-100">
              
              <div class="position-relative w-100 rounded-top overflow-hidden shadow-lg bg-black" style="padding-top: 145%;">
                {% if manga.portada %}
                  <img src="{{ manga.portada.url }}" 
                       alt="{{ manga.titulo }}" 
                       class="position-absolute top-0 start-0 w-100 h-100 object-fit-cover transition-transform"
                       loading="lazy">
                {% else %}
                  <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-secondary bg-opacity-10">
                    <img src="{% static 'images/sinfondo.png' %}" width="60" class="opacity-25 grayscale">
                  </div>
                {% endif %}
                
                <div class="position-absolute top-0 end-0 p-2">
                  <span class="badge bg-primary bg-opacity-90 shadow-sm backdrop-blur">Leer</span>
                </div>

                <div class="position-absolute bottom-0 start-0 w-100 h-50 bg-gradient-to-t"></div>
              </div>
              
              <div class="card-body p-3 bg-surface border-top border-white border-opacity-5 position-relative">
                
                {% if manga.genero %}
                  <div class="mb-2">
                    <span class="badge bg-dark border border-secondary text-secondary" style="font-size: 0.65rem; letter-spacing: 0.5px;">
                      {{ manga.get_genero_display|upper }}
                    </span>
                  </div>
                {% endif %}

                <h6 class="card-title text-white fw-bold text-truncate mb-1" title="{{ manga.titulo }}">
                  {{ manga.titulo }}
                </h6>
                <p class="card-text text-white-50 small text-truncate mb-0">
                  {{ manga.autor|default:"Autor desconocido" }}
                </p>
              </div>

            </a>
          </div>

        </div>
      {% endfor %}
    </div>

  {% else %}
    <div class="text-center py-5">
      <div class="mb-4 opacity-25">
        <img src="{% static 'images/sinfondo.png' %}" width="120" class="grayscale">
      </div>
      <h3 class="text-white fw-bold">El archivo está vacío</h3>
      <p class="text-secondary">No hay mangas disponibles en este momento.</p>
      {% if user.is_authenticated %}
        <a href="{% url 'catalogo:manga-create' %}" class="btn btn-outline-primary mt-3">Ser el primero en aportar</a>
      {% endif %}
    </div>
  {% endif %}
</div>

<style>
  /* Estilos específicos para esta vista */
  .text-gradient-cyan {
    background: linear-gradient(to right, #00e5ff, #7c4dff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }
  
  /* Animación de Zoom en la portada */
  .group-hover:hover img.transition-transform { transform: scale(1.1); }
  .transition-transform { transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  
  /* Fondos y Bordes */
  .bg-surface { background-color: #18181b; transition: background-color 0.3s; }
  .group-hover:hover .bg-surface { background-color: #202023; }
  
  .bg-gradient-to-t { background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%); }
  .backdrop-blur { backdrop-filter: blur(4px); }
  
  .grayscale { filter: grayscale(100%); }
  .ls-1 { letter-spacing: 1px; }
  
  /* Efecto Hover en la tarjeta completa */
  .mv-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
  .mv-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
    border-color: rgba(124, 77, 255, 0.3) !important; /* Borde morado suave al hover */
  }
</style>
{% endblock %}