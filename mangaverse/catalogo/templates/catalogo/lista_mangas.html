{% extends 'base.html' %}
{% load static %}

{% block title %}Catálogo | MangaVerse{% endblock %}

{% block content %}
<div class="container py-5">
  
  <div class="row align-items-end mb-4 border-bottom border-white border-opacity-10 pb-4">
    <div class="col-md-8">
      <h1 class="display-4 fw-bold text-white mb-0 text-uppercase ls-1" style="font-family: 'Rajdhani', sans-serif;">
        Explorar <span class="text-gradient-cyan">Mangas</span>
      </h1>
      <p class="text-secondary mt-2 mb-0">
        Descubre tu próxima obsesión entre nuestra colección de <span class="text-white fw-bold">{{ mangas.count }}</span> títulos.
      </p>
    </div>
    
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      {% if user.is_authenticated %}
        <a href="{% url 'catalogo:manga-create' %}" class="btn btn-brand-neon px-4 py-2 rounded-pill shadow-neon transition-transform hover-lift">
          <span class="fs-5 align-middle me-1">+</span> Nuevo Manga
        </a>
      {% endif %}
    </div>
  </div>

  <div class="mb-5 overflow-auto">
    <div class="d-flex gap-2 pb-2 category-scroll">
      
      <a href="{% url 'catalogo:lista-mangas' %}" 
         class="btn rounded-pill px-4 fw-bold transition-all {% if not filtro_actual %}btn-cyan-active{% else %}btn-outline-secondary text-white-50{% endif %}">
        Todos
      </a>

      {% for codigo, nombre in generos %}
        <a href="?genero={{ codigo }}" 
           class="btn rounded-pill px-4 fw-bold transition-all text-nowrap {% if filtro_actual == codigo %}btn-cyan-active{% else %}btn-outline-dark-custom{% endif %}">
          {{ nombre }}
        </a>
      {% endfor %}
      
    </div>
  </div>

  {% if mangas %}
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
      {% for manga in mangas %}
        <div class="col">
          
          <div class="card mv-card h-100 border-0 overflow-hidden position-relative group-hover bg-dark">
            <a href="{% url 'catalogo:manga-detail' manga_slug=manga.slug %}" class="text-decoration-none d-block h-100">
              
              <div class="position-relative w-100 rounded-top overflow-hidden shadow-lg bg-black" style="padding-top: 145%;">
                {% if manga.portada %}
                  <img src="{{ manga.portada.url }}" 
                       alt="{{ manga.titulo }}" 
                       class="position-absolute top-0 start-0 w-100 h-100 object-fit-cover transition-transform"
                       loading="lazy">
                {% else %}
                  <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-secondary bg-opacity-10">
                    <img src="{% static 'images/sinfondo.png' %}" width="60" class="opacity-25 grayscale">
                  </div>
                {% endif %}
                
                <div class="position-absolute top-0 end-0 p-2 opacity-0 group-hover-opacity-100 transition-opacity">
                  <span class="badge bg-primary shadow-sm backdrop-blur">Leer</span>
                </div>

                <div class="position-absolute bottom-0 start-0 w-100 h-50 bg-gradient-to-t"></div>
              </div>
              
              <div class="card-body p-3 bg-surface border-top border-white border-opacity-5 position-relative">
                
                {% if manga.genero %}
                  <div class="mb-2">
                    <span class="badge bg-dark border border-secondary text-secondary" style="font-size: 0.6rem; letter-spacing: 0.5px;">
                      {{ manga.get_genero_display|upper }}
                    </span>
                  </div>
                {% endif %}

                <h6 class="card-title text-white fw-bold text-truncate mb-1" title="{{ manga.titulo }}">
                  {{ manga.titulo }}
                </h6>
                <p class="card-text text-white-50 small text-truncate mb-0">
                  {{ manga.autor|default:"Autor desconocido" }}
                </p>
              </div>

            </a>
          </div>

        </div>
      {% endfor %}
    </div>

  {% else %}
    <div class="text-center py-5">
      <div class="mb-4 opacity-25">
        <img src="{% static 'images/sinfondo.png' %}" width="100" class="grayscale">
      </div>
      <h4 class="text-white fw-bold">No hay mangas en esta categoría</h4>
      <p class="text-secondary">Intenta con otro filtro o agrega uno nuevo.</p>
      <a href="{% url 'catalogo:lista-mangas' %}" class="btn btn-outline-light btn-sm mt-2">Ver Todos</a>
    </div>
  {% endif %}
</div>

<style>
  /* ESTILOS DE FILTRO (PILLS) */
  
  /* Scroll horizontal oculto para los filtros en móvil */
  .category-scroll {
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE */
    mask-image: linear-gradient(to right, black 90%, transparent 100%);
  }
  .category-scroll::-webkit-scrollbar { display: none; }

  /* Botón Activo (Neón Cian) */
  .btn-cyan-active {
    background-color: #00e5ff;
    color: #000 !important;
    border: 1px solid #00e5ff;
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
  }

  /* Botón Inactivo (Outline Dark) */
  .btn-outline-dark-custom {
    background-color: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.6);
  }
  .btn-outline-dark-custom:hover {
    background-color: rgba(255, 255, 255, 0.1);
    border-color: #00e5ff;
    color: white;
    transform: translateY(-2px);
  }

  /* Estilos Generales */
  .text-gradient-cyan {
    background: linear-gradient(to right, #00e5ff, #7c4dff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }
  
  .group-hover:hover img.transition-transform { transform: scale(1.1); }
  .transition-transform { transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
  .group-hover-opacity-100:hover { opacity: 1 !important; }
  .transition-opacity { transition: opacity 0.3s ease; }
  
  .bg-surface { background-color: #18181b; transition: background-color 0.3s; }
  .group-hover:hover .bg-surface { background-color: #202023; }
  
  .bg-gradient-to-t { background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%); }
  .backdrop-blur { backdrop-filter: blur(4px); }
  .grayscale { filter: grayscale(100%); }
  .ls-1 { letter-spacing: 1px; }
  
  .mv-card { transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s; }
  .mv-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
    border-color: rgba(124, 77, 255, 0.3) !important;
  }
  .transition-all { transition: all 0.3s ease; }
</style>
{% endblock %}